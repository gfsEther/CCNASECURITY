chapter 1 - Understand Network

- 3 basic concepts = Confidentially, Integrity and Availability

- Risk management:
  asset = anything that is valuable to an organization
  vunerability = is an exploitable weakness in a system or its design
  treat = any potencial danger to an asset (latent - vunerability exist but not yet realized
                                            realized - attack already lauched to ur system and compromises yout security against an asset.
                                            threat agent/vector - the entity that takes advantage of the vunerability.)
  countermeasure = is a safeguard that somehow mitigates a potencial risk.


ASSET - An asset is an item that is to be protected and can include property, people, and information/data that have value to the company. This includes intangible items such as proprietary information or trade secrets and the reputation of the company. The data could include company records, client information, proprietary software, and so on.

VUNERABILITY - A vulnerability is an exploitable weakness of some type. That exploitation might result from a malicious attack, or it might be accidentally triggered because of a failure or weakness in the policy, implementation, or software running on the network.

THREAT - This is what you are protecting against. A threat is anything that attempts to gain unauthorized access to, compromise, destroy, or damage an asset. Threats are often realized via an attack or exploit that takes advantage of an existing vulnerability.
Threats today come in many varieties and spread more rapidly than ever before. Threats can also morph and be modified over time, and so you must be ever diligent to keep up with them.

RISK - Risk is the potential for unauthorized access to, compromise, destruction, or damage to an asset. If a threat exists, but proper countermeasures and protections are in place (it is your goal to provide this protection), the potential for the threat to be successful is reduced (thus reducing the overall risk).

COUNTERMEASURE - A countermeasure is a device or process (a safeguard) that is implemented to counteract a potential threat, which thus reduces risk.

ASSET CLASSIFICATION:
  Governmental classifications    Unclassified
                                  Sensitive but unclassified (SBU)
                                  Confidential
                                  Secret
                                  Top secret

  Private sector classifications  Public
                                  Sensitive
                                  Private
                                  Confidential
                                  
  Classification criteria         Value
                                  Age
                                  Replacement cost
                                  Useful lifetime

  Classification roles            Owner (the group ultimately responsible for the data, usually senior management of a company)
                                  Custodian (the group responsible for implementing the policy as dictated by the owner)
                                  User (those who access the data and abide by the rules of acceptable use for the data)

VUNERABILITY CLASSIFICATION:
  Policy flaws
  Design errors
  Protocol weaknesses
  Misconfiguration
  Software vulnerabilities
  Human factors
  Malicious software
  Hardware vulnerabilities
  Physical access to network resources

Dictionaty of known vunerabilities:
  Common Vulnerabilities and Exposures (CVE)
  National Vulnerability Database (NVD)

COUNTERMEASURE CLASSIFICATION:
  Administrative - These consist of written policies, procedures, guidelines, and standards. An example would be a written acceptable use policy (AUP), agreed to by each user on the network. Another example is a change control process that needs to be followed when making changes to the network. Administrative controls could involve items such as background checks for users, as well.

  Physical - Physical controls are exactly what they sound like, physical security
  for the network servers, equipment, and infrastructure. An example is providing a locked door between users and the wiring closet on any floor (where the switches and other gear exists). Another example of a physical control is a redundant system (for instance, an uninterruptible power supply).

  Logical - Logical controls include passwords, firewalls, intrusion prevention systems, access lists, VPN tunnels, and so on. Logical controls are often referred to as technical controls.

POTENCIAL ATTACKERS:
  Terrorists
  Criminals
  Government agencies
  Nation-states
  Hackers
  Disgruntled employees
  Competitors
  Anyone with access to a computing device (sad, but true)

ATTACK METHODS
  Reconnaissance - This is the discovery process used to find information about the network. It could include scans of the network to find out which IP addresses respond, and further scans to see which ports are open. This is usually the first step taken, to discover what is on the network and to determine potential vulnerabilities.

  Social engineering - This is a tough one because it leverages our weakest (very likely) vulnerability in a secure network: the user. If the attacker can get the user to reveal information, it is much easier for the attacker than using some other method of reconnaissance. This could be done through email or misdirection of web pages, which results in the user clicking something that leads to the attacker gaining information. Social engineering can also be done in person or over the phone.
    Phishing presents a link that looks like a valid trusted resource to a user. When the user clicks it, the user is prompted to disclose confidential information such as usernames/passwords.
    Pharming is used to direct a customer’s URL from a valid resource to a malicious one that could be made to appear as the valid site to the user. From there, an attempt is made to extract confidential information from the user.

  Privilege escalation - This is the process of taking some level of access (whether authorized or not) and achieving an even greater level of access. An example is an attacker who gains user mode access to a router and then uses a brute- force attack against the router, determining what the enable secret is for privilege level 15 access.

  Back doors - When attackers gain access to a system, they usually want future access, as well, and they want it to be easy. A backdoor application can be installed to either allow future access or to collect information to use in further attacks.
  Many back doors are installed by users clicking something without realizing the link they click or the file they open is a threat. Back doors can also be implemented as a result of a virus or a worm (often referred to as malware).

GUIDELINE TO NETWORK SECURITY
  Rule of least privilege - This rule states that minimal access is only provided to the required network resources, and not any more than that. An example of this is an access list applied to an interface for filtering that says deny all. Before this, specific entries could be added allowing only the bare minimum of required protocols, and only then between the correct source and destination addresses.

  Defense in depth - This concept suggests that you have security implemented on
  nearly every point of your network. An example is filtering at a perimeter router, filtering again at a firewall, using IPSs to analyze traffic before it reaches your servers, and using host-based security precautions at the servers, as well. This is defense in depth. Using authentication and authorization mechanisms could also be part of a defense-in-depth approach.
  The concept behind defense in depth is that if a single system fails, it does not mean that security has completely been removed from the equation. 

  Separation of duties - By placing specific individuals into specific roles, there can be checks and balances in place regarding the implementation of the security policy. Rotating individuals into different roles periodically will also assist in verifying that vulnerabilities are being addressed, because a person who moves into a new role will be required to review the policies in place.

  Auditing - This refers to accounting and keeping records about what is occurring on the network. Most of this can be automated through the features of authentication, authorization, and accounting (AAA) (covered later in this book). When events happen on the network, the records of those events can be sent to an accounting server. When the separation-of-duties approach is used, those who are making changes on the network should not have direct access to modify or delete the accounting records that are kept on the accounting server.

SECURITY NETWORK LIFECYCLE
  Initiation -  This involves preliminary risk assessments and categorizing of risk, such as with labels of low, medium, or high. These assessments and labels can assist you in prioritizing security measures by focusing on the high-risk items first.

  Acquisition and development - This involves a more detailed risk assessment, acquiring the products and tools needed to implement the countermeasures needed to reduce risk, and testing those countermeasures (usually on a closed network or as a pilot program) to verify their correct implementation.

  Implementation - This is the actual point where the rubber meets the road, where you put the countermeasures in place on the production network.

  Operations and maintenance - This involves monitoring and with the care and feeding of our network security devices (and incident handling when issues arise).

  Disposition - All things come to an end, and disposing of network gear (including sanitizing/formatting/destroying media storage devices) is part of this.

DETERMINE THE IMPACT OF A RISK
  Qualitative - In this method, the data is gathered by an individual, who likely is a subject matter expert (in this case as to the asset’s value, its vulnerabilities, potential threats, and the impact or risk based on those factors).

  Quantitative - In this method, you use raw data, numbers, and statistics to determine the risk.

ASSET TO BE CONSIDERED
  Value of the asset
  Vulnerabilities
  Potential threats
  Compliance issues
  Business requirements

CALCULATE THE RISK:
  Using qualitative/quantitative approaches, identify the risk (value of asset, vulnerability, potential threats = risk).

  Take action regarding the risk (which could include transferring the risk, accepting the risk, or reducing the risk using countermeasures).

  Monitor the risk. This includes verification that the countermeasures are reducing the risk and making adjustments regarding that risk if it is increasing or decreasing based on changes in the network, changes in access to data, or changes based on new types of threats.

TYPE OF POLICY
  Guideline policies - These include AUPs, audit policies, password policies, risk assessment policies, web server policies, and so on.

  Email policies - These include email-forwarding policies, spam policies, and so on.

  Remote-access policies - These include virtual private network (VPN) remote access, dial-in access, and minimum requirements for remote access with regard to virus scanning or patches.

  Telephony policy - This includes guidance about the acceptable use of telephony services related to voice/data over that media.

  Application policies - These include minimum security requirements that need to be included in new applications that are added to the network and restrictions about what end users are allowed to install and or run on their local computers.

  Network policies - These include standards for access via wireless or wired connections, and could include minimum requirements for the PCs that are connecting, such as minimum service packs, specific antivirus properties (such as current antivirus that has been updated in the past 4 days), and other network-related activity.

TOOL TO USE AS TEST
  Network scanning
  Vulnerability scanning
  Password cracking
  Penetration testing
  Social engineering attempts

incident - means an event on the network that has negative impact (risk involved).

BORDERLESS NETWORK COMPONENTS

  Borderless end zone - This is where devices connect to the network. It is here that we are concerned with viruses, malware, and other malicious software. Using techniques such as Network Admissions Control (NAC) and Identity Services Engine (ISE), we can properly interrogate devices before they are allowed onto the network to verify they meet certain minimum requirements (installations of virus scanning tools, service packs, patch revision levels, and so on).

  Borderless data center - This represents a cloud-driven business environment that could provide services. It is in this borderless data center where we implement firewalls such as the Adaptive Security Appliance (ASA) and intrusion prevention systems (IPS) to protect network resources there. Virtual tools can also be used inside virtual environments in the data center, such as virtual switches that can enforce policy on virtual devices that are connected to that virtual switch.

  Borderless Internet - This represents the biggest IP network on the planet, which we are all familiar with. Service providers and other individuals connected to the Internet use various techniques for security, including IPSs, firewalls, and protocol inspection (all the way from Layer 2 to Layer 7 of the OSI model).

  Policy management point - In a perfect environment, we would have a single point of control
  that could implement appropriate security measures across the entire network. Cisco Security Manager (CSM) is an example of one of these enterprise tools. Another example is Cisco Access Control Server (ACS), which provides contextual access. For example, if you want to allow administrators full access to a router only if they are logging in from a specific location, you could enforce that with ACS and authentication, authorization, accounting (AAA) rules. Under that same system, administrators could also potentially gain access from other locations.

  Context awareness - This just what is sounds like: being aware of context. For example, you might want to confirm a basic set of parameters (who users are, how they are accessing a network, the condition of the computer they are using to access the network, and so on) before giving users access. Actual tools to implement this include ISE, NAC, and AAA.

SECUREX
  Context awareness - This just what is sounds like: being aware of context. For example, you might want to confirm a basic set of parameters (who users are, how they are accessing a network, the condition of the computer they are using to access the network, and so on) before giving users access. Actual tools to implement this include ISE, NAC, and AAA.

  AnyConnect Client - With AnyConnect Client, you can establish Secure Sockets Layer (SSL) or IPsec VPNs for clients. VPNs provide for confidentiality of the data in motion and the integrity of that data.

  TrustSec - This creates a distributed access policy enforcement mechanism, and can also use encryption to provide confidentiality. The intent is to provide and control end-to-end security, based on who, what, where, and how users are connected to the network. Endpoint systems are analyzed to verify they meet corporate security requirements. Actual tools to implement this include ISE, NAC, and AAA. If security group tags (SGT) are used, devices involved in forwarding the traffic can implement the appropriate security based on the tag. Data can be encrypted for confidentiality, as well.

  Security Intelligence Operations - Security Intelligence Operations (SIO) is a cloud-based service that Cisco manages. This service identifies and correlates realtime threats so that customers can leverage this information to better protect their networks. An example is learning about an attack that is propagating through the Internet before it reaches your network, thus enabling you to place additional security measures in preparation for its arrival at your perimeter.

CONTROLLING AND CONTAINING DATA LOSS
  ASA firewalls: The Cisco ASA provides packet filtering, stateful filtering (all cov- ered in the firewall section), support for IPsec remote-access and IPsec site-to-site VPNs, and VPN support for SSL remote-access users. An additional module can provide intrusion prevention services, as well.

  Integrated Services Routers (ISR): Building on the routing infrastructure, you can integrate additional security into the router itself using features such as zonebased firewalls and IPSs (in software or IPS modules installed through an available option slot in the chassis). Routers support VPNs, authenticated routing protocols, packet filtering, and a wide variety of other security features.

  Intrusion prevention systems (IPS): An IPS is implemented as a standalone appliance, or you can implement it as a module that goes into a Cisco ASA firewall or router. In addition, you can place a blade module in a 6500 series switch. An IPS, using primarily signature matching, can identify malicious traffic and prevent attacks from being forwarded into the network.

  IronPort Email Security Appliances and IronPort Web Security Appliances (WSA): These appliances provide granular control of email and, in the case of web traffic and WSA, can track thousands of applications and enforce security policies to protect networks against threats.

  ScanSafe: ScanSafe web security can dynamically categorize search engine results to prevent access to undesired sites or content, and can also look for malicious content, thus offering protection for zero-day attacks that have not been identified through traditional IPS signatures.

NETWORK FOUNDATION PROTECTION
  Management plane: This includes the protocols and traffic that an administrator uses between his workstation and the router or switch itself. An example is using a remote management protocol such as Secure Shell (SSH) to monitor or configure the router or switch. The management plane is listed here first because until the device is configured (which occurs in the management plane), the device will not be too functional in a network. If a failure occurs in the management plane, it may result in losing the ability to manage a network device.

  Control plane: This includes protocols and traffic that the network devices use on their own without direct interaction from an administrator. An example is a routing protocol. A routing protocol can dynamically learn and share routing information that the router can then use to maintain an updated routing table. If a failure occurs in the control plane, a router may lose the ability to share or correctly learn dynamic routing information, and as a result not have the routing intelligence to be able to route for the network.

  Data plane: This includes traffic that is being forwarded through the network (sometimes called transit traffic). An example is a user on one part of the network who is accessing a server; the data plane represents the traffic that is either being switched or forwarded by the network devices between the client and server. A failure of some component in the data plane results in the customer’s traffic not being able to be forwarded. Other times, based on policy, you might want to deny specific types of traffic on the data plane.

CONTROL PLANE
  CoPP - Control plane policing. You can configure this as a filter for any traffic destined to an IP address on the router itself. For example, you can specify that management traffic, such as SSH/HTTPS/SSL and so on,
  can be rate-limited (policed) down to a specific level. This way, if an attack occurs that involves an excessive amount of this traffic, the excess traffic above the threshold set could simply be ignored and not have
  to be processed directly by the CPU. Another way to think of this is as applying quality of service (QoS) to the valid management traffic and policing to the bogus management traffic.
  This is applied to a logical control plane interface (not directly to any Layer 3 interface) so that the policy can be applied globally to the router.

  CPPr - Control plane protection. This allows for a more detailed classification of traffic (more than CoPP) that is going to use the CPU for handling. The three specific subcategories that can be classified are traffic to one of the physical or logical interfaces of the router, certain data plane traffic that requires CPU intervention before forwarding (such as IP options), and Cisco Express Forwarding (CEF) exceptions (traffic related to network operations, such as keepalives or packets with Time-To-Live (TTL) mechanisms that are expiring) that have to involve the CPU.
  The benefit of CPPr is that you can rate-limit and filter this type of traffic with a more fine-toothed comb than CoPP.
  This is also applied to a logical control plane interface, so that regardless of the logical or physical interface the packets come in on, the router processor can still have the protection.

CCP CONFIGURATION
  R1(config)# ip http server
  R1(config)# ip http secure-server
  R1(config)# username admin privilege 15 secret cisco
  R1(config)# ip http authentication local

  Community - is a group of routers that share something in common. Each community can contain a maximum of 10 devices.

  One-Step Lockdown
    Disable Finger Service: Finger is used to find out which users are logged in to a network device. Although this information is not usually tremendously sensitive, it can sometimes be useful to an attacker.

    Disable TCP and UDP Small Servers Service: By default, older IOS enables the “small services”: echo, chargen, and discard. (Small services are disabled by default in the current IOS. These services are rarely used for legitimate purposes, but they can be used to launch denial-of-service [DoS] and other attacks.)

    Disable IP BOOTP Server Service: BOOTP allows both routers and computers to automatically configure from a centrally maintained server upon startup, including downloading Cisco IOS software. As a result, BOOTP can potentially be used by an attacker to download a copy of a router’s Cisco IOS software. This service is also vulnerable to DoS attacks, which could affect the router overall.

    Disable IP Identification Service: Identification support allows you to query a TCP port for identification. It is potentially dangerous to allow any system on a directly connected segment to learn that the router is a Cisco device and to determine the model number and the Cisco IOS software version being run. This information may be used to design attacks against the router.

    Disable CDP: This is dangerous in that it allows any system on a directly connected segment to learn that the router is a Cisco device and to determine the model number and the Cisco IOS software version being run. This information may be used to design attacks against the router.

    Disable IP Source Route: The IP protocol supports source routing options that allow the sender of an IP datagram to control the route that the datagram takes toward its ultimate destination, and generally the route that any reply takes. These options are rarely used for legitimate purposes in networks. Allowing the sender of a packet to control the path through your network is not a good idea.

    Enable Password Encryption Service: Providing a light encryption of a plaintext password prevents an individual who may be glancing at the configuration from being able to know what the actual plaintext password is.

    Enable TCP Keepalives for Inbound and Outbound Telnet Sessions: Enabling TCP keepalives causes the router to generate periodic keepalive messages, letting it detect and drop broken Telnet connections, and not leaving them open for potential unauthorized access.

    Enable IP CEF: Routes configured for Cisco Express Forwarding (CEF) perform better under SYN attacks than routers using the traditional cache.

    Disable IP Gratuitous ARPs: A gratuitous Address Resolution Protocol (ARP) is an ARP broadcast in which the source and destination IP addresses are the same. It is used primarily by a host to inform the network about its IP address. Gratuitous means that an ARP reply is sent without an initial request from another station. A spoofed gratuitous ARP message can cause network mapping information to be stored incorrectly, or the wrong devices to be used, causing network malfunctions.

    Set Minimum Password Length to More Than 6 Characters: One method attackers use to crack passwords is to try all possible combinations of characters until the password is discovered. Longer passwords have exponentially more possible combinations of characters, making this method of attack much more difficult.

    Set Authentication Failure Rate to Less Than 3 Retries: One method of cracking passwords, called the “dictionary” attack, is to use software that attempts to log in using every word in a dictionary. This configuration causes access to the router to be locked for a period of 15 seconds after three unsuccessful login attempts, disabling the dictionary method of attack. In addition to locking access to the router, this configuration causes a log message to be generated after three unsuccessful login attempts, warning the administrator of the unsuccessful login attempts.

    Set TCP SYN-Wait Time to 10 Seconds: A SYN-flood attack sends repeated connection requests to a host, but never sends the acceptance of acknowledgments that complete the connections, creating increasingly more incomplete connections at the host. This can overwhelm and disable the host. Setting the TCP SYN-Wait time to 10 seconds causes the router to shut down an incomplete connection after 10 seconds, preventing the buildup of incomplete connections at the host.

    Set Banner: This is to provide a banner informing unauthorized users that their use is in fact unauthorized.

    Enable Logging: Because it gives detailed information about network events, logging is critical in recognizing and responding to security events.

    Set Enable Secret Password: The enable secret command is used to set the password that grants privileged administrative access to the Cisco IOS system.

    Disable SNMP: Version 1 of the Simple Network Management Protocol (SNMP) is the most commonly used and is often a security risk because it uses authentication strings (passwords) called community strings that are stored and sent across the network in plain text. It is an easy-to-spoof protocol. SNMP is a valid protocol to run on your network to properly manage it, but it is considered a more advanced topic at this point because you should take extra precautions to secure the protocol and properly manage a network. For now, disabling it is the safest option (until you can revisit it later).

    Set Scheduler Interval: When a router is fast-switching a large number of packets, it is possible for the router to spend so much time responding to interrupts from the network interfaces that no other work gets done. Some very fast packet floods can cause this condition. It may stop administrative access to the router, which is dangerous when the device is under attack. Tuning the scheduler interval ensures that management access to the router is always available by causing the router to run system processes after the specified time interval, even when CPU usage is at 100 percent.

    Set Scheduler Allocate: On routers that do not support the command scheduler interval, Security Audit configures the scheduler allocate command whenever possible.

    Set Users: Security Audit secures the console, AUX, vty, and tty lines by configuring Telnet user accounts to authenticate access to these lines whenever possible. Security Audit displays a dialog box in which you can define user accounts and passwords for these lines.

    Enable Telnet Settings: Security Audit secures the console, AUX, vty, and tty lines by implementing the transport input and transport output commands to define which protocols can be used to connect to those lines. It also sets the exec-timeout value to ten minutes on the console and AUX lines, causing an administrative user to be logged out from these lines after ten minutes of no activity.

    Disable IP Redirects: ICMP supports IP traffic by relaying information about paths, routes, and network conditions. ICMP redirect messages instruct an end node to use a specific router as its path to a particular destination. In a properly functioning IP network, a router sends redirects only to hosts on its own local subnets; no end node ever sends a redirect, and no redirect ever traverses more than one network hop. However, an attacker may violate these rules; some attacks are based on this. Disabling ICMP redirects causes no operational impact to the network, and it eliminates this possible method of attack.

    Disable IP Proxy ARP: ARP is used by the network to convert IP addresses into MAC addresses. Normally, ARP is confined to a single LAN, but a router can act as a proxy for ARP requests, making ARP queries available across multiple LAN segments. Because it breaks the LAN security barrier, you should use proxy ARP only between two LANs with an equal security level, and only when necessary.

    Disable IP Directed Broadcast: An IP directed broadcast is a datagram that is sent to the broadcast address of a subnet to which the sending machine is not directly attached. The directed broadcast is routed through the network as a unicast packet until it arrives at the target subnet, where it is converted into a link-layer broadcast. By sending a continuous stream of request packets, using a spoofed source address, the attacker can create a much larger stream of replies, which can completely inundate the host whose address is being falsified.

    Disable MOP Service: Maintenance Operations Protocol (MOP) is used to provide configuration information to the router when communicating with DECnet networks. MOP is vulnerable to various attacks, and it is unlikely that anyone is running DECnet any longer.

    Disable IP Unreachables: ICMP supports IP traffic by relaying information about paths, routes, and network conditions. ICMP host unreachable messages are sent out if a router receives a nonbroadcast packet that uses an unknown protocol, or if the router receives a packet that it is unable to deliver to the ultimate destination because it knows of no route to the destination address. These messages can be used by an attacker to gain network mapping information.

    Disable IP Mask Reply: ICMP mask reply messages are sent to the device requesting the information by devices that have the requested information. An attacker can use these to gain network mapping information.

    Enable Unicast RPF on Outside Interfaces: Reverse Path Forwarding (RPF) causes the router to check the source address of any packet against the interface through which the packet entered the router. If the input interface is not a feasible path to the source address according to the routing table, the packet is dropped. This source address verification is used to defeat IP spoofing.

    Enable Firewall on All of the Outside Interfaces: The IOS firewall filters packets and performs session tracking, based on application layer information, such as the type of session such as HTTP or DNS requests. Traffic specified by the firewall policy is allowed to flow through the firewall.

    Set Access Class on HTTP Server Service and vty Lines: Security Audit limits access to the HTTP service and vty lines by configuring an access class that permits access only from directly connected network nodes.

    Enable SSH for Access to the Router: Secure Shell (SSH) is the preferred secure method for remote-access command-line access to the router because the session is encrypted.

    Enable AAA: Cisco IOS Authentication, Authorization, and Accounting (AAA) service provides a modular way of performing authentication, authorization, and accounting services. Authentication using the running configuration (a user that is in the running configuration) is required for HTTP, console, and vty access to the router.

MANAGEMENT PLANE BEST PRATICE
  Strong passwords: Make passwords very difficult to break. 

  User authentication and AAA: Require administrators to authenticate using usernames and passwords. 

  Role-based access control (RBAC): Not every administrator needs full access to every device, and you can control this through AAA and custom privilege levels/ parser views. 

  Encrypted management protocols: When using either in-band or out-of-band management, encrypted communications should be used, such as Secure Shell (SSH) or Hypertext Transfer Protocol Secure (HTTPS). Out-of-band (OOB) management implies that there is a completely separate network just for management protocols and a different network for end users and their traffic. In-band management is when the packets used by your management protocols may intermingle with the user packets (considered less secure than OOB). 

  Logging: Logging is a way to create an audit trail. 

  Network Time Protocol (NTP): Use NTP to synchronize the clocks on network devices so that any logging that includes time stamps may be easily correlated. Preferably, use NTP Version 3, to leverage its ability to provide authentication for time updates. This becomes very important to correlate logs between devices in case there is ever a breach and you need to reconstruct (or prove in a court of law) what occurred.

  Secure system files: Make it difficult to delete, whether accidentally or on purpose, the startup configuration files and the IOS images that are on the file systems of the local routers and switches. You can do so by using built-in IOS features discussed later in this chapter.

AAA configuration
  R1(config)# aaa new-model
  R1(config)# tacacs-server host 50.50.4.101
  R1(config)# tacacs-server key ToUgHPaSsW0rD-1#7
  R1(config)# aaa authentication login default local enable (locally)
  R1(config)# aaa authentication login MY-LIST-1 group tacacs local enable
  R1(config)# aaa authorization commands 1 TAC1 group tacacs+ local (for commands at level 1 - privilege level 1)
  R1(config)# aaa authorization commands 15 TAC15 group tacacs+ local (for commands at level 15 - privilege exec mode)
  R1(config)# aaa accounting commands 1 TAC-act1 start-stop group tacacs+ R1(config)# aaa accounting commands 15 TAC-act15 start-stop group tacacs+
  R1(config)# username admin privilege 15 secret 4Je7*1swEsf (in case the ACS couldnt be reached)
  R1(config)# line vty 0 4
  R1(config-line)# login authentication MY-LIST-1
  R1(config-line)# authorization commands 1 TAC1
  R1(config-line)# authorization commands 15 TAC15
  R1(config-line)# accounting commands 1 TAC-act1
  R1(config-line)# accounting commands 15 TAC-act15

Custom Privilege Level (config)
  R2(config)# privilege exec level 8 configure terminal
  R2(config)# enable secret level 8 0 NewPa5s123& (The "0" before the password, implies that we are inputting a non-hashed ! (to begin with) password)
  R2(config)# end

Parser View (config)
  R2(config)# enable secret aBc!2#&iU 
  R2(config)# aaa new-model 
  R2(config)# end
  R2# enable view
  R2# configure terminal
  R2(config)# parser view New_VIEW
  R2(config-view)# secret New_VIEW_PW
  R2(config-view)# commands exec include ping (commands "exec" refer to commands issued from the command prompt)
  R2(config-view)# commands exec include all show
  R2(config-view)# commands exec include configure
  R2(config-view)# commands configure include access-list (commands "configure" refer to commands issued from privileged mode)
  R2(config-view)# exit
  R2# disable (to get in the new view)
  R2>enable view New_VIEW
  R2# show parser view (This command reports what view we are currently using)
  R2(config)# username Lois view New_VIEW secret cisco123 (automatically place users into their view) ps:This creation of a username and assigning that user to a view needs to be done by someone who is at privilege level 15.

SSH (config)
  Router(config)# hostname R1
  R1(config)# ip domain-name cisco.com  
  R1(config)# crypto key generate rsa
  R1(config)# username Keith secret Ci#kRk*ks
  R1(config)# line vty 0 4
  R1(config-line)# login local
    or
  R1(config)# aaa new-model
  R1(config)# aaa authentication login Keith-List-1 local
  R1(config)# line vty 0 4
  R1(config-line)# login authentication Keith-List-1
  R1# ssh -l Keith 10.1.0.1 (testing)
  R1>show ssh (to verify the current SSH session(s))

HTTPS (config)
  R1(config)# ip http secure-server
  R1(config)# ip http authentication local 
                                      or aaa or enable (enable password)

AAA
  Identity Services Engine (ISE) is an identity and access control policy platform that can validate that a computer meets the requirements of a company’s policy related to virus definition files, service pack levels, and so on before allowing the device on the network.

Layer 2 Best Practices
  - Select an unused VLAN (other than VLAN 1) and use that for the native VLAN for all your trunks.
  - Avoid using VLAN 1 anywhere, because it is a default.
  - Administratively configure access ports as access ports so that users cannot negotiate a trunk and disable the negotiation of trunking (no Dynamic Trunking Protocol [DTP]).
  - Limit the number of MAC addresses learned on a given port with the port security feature.
  - Control spanning tree to stop users or unknown devices from manipulating spanning tree. You can do so by using the BPDU guard and root guard features.
  - Turn off Cisco Discovery Protocol (CDP) on ports facing untrusted or unknown networks that do not require CDP for anything positive. (CDP operates at Layer 2 and may provide attackers information we would rather not disclose.)
  - On a new switch, shut down all ports and assign them to a VLAN that is not used for anything else other than a parking lot. Then bring up the ports and assign correct VLANs as the ports are allocated and needed.

  configuration:
    SW2(config)# int fa0/2
    SW2(config-if)# switchport mode access
    SW2(config-if)# switchport access VLAN 10
    SW2(config-if)# switchport nonegotiate (This command disables DTP, which otherwise is still on by default, even for an interface configured as an access port.)
    SW2(config-if)# int fa 0/23
    SW2(config-if)# switchport trunk encapsulation dot1q 
    SW2(config-if)# switchport mode trunk
    SW2(config-if)# switchport trunk native vlan 3
    SW2(config-if)# switchport nonegotiate

  Tool description:
    Port security - Limits the number of MAC addresses to be learned on an access switch port.
      SW2(config-if)# int fa 0/2     
      SW2(config-if)# switchport port-security
      SW2(config-if)# switchport port-security maximum 5 (Set the maximum to desired number. Default is 1)
      SW2(config-if)# switchport port-security violation protect
      SW2(config-if)# switchport port-security mac-address sticky
    BPDU guard - If BPDUs show up where they should not, the switch protects itself.
      SW2(config-if)# int fa 0/2
      SW2(config-if)# spanning-tree bpduguard enable
      SW2(config)# errdisable recovery cause bpduguard (Automatically Restore Err-Disabled Ports)
      SW2(config)# errdisable recovery interval 30 (err-disabled ports will be brought back up after 30 seconds of no bpdu violations)
    Root guard - Control which ports are not allowed to become root ports to remote root switches.
      SW1(config)# int fa 0/24
      SW1(config-if)# spanning-tree guard root (This will also help in preventing tampering of your existing STP topology.)
    Dynamic ARP inspection(DAI) - Prevents spoofing of Layer 2 information by hosts.
    IP source guard - Prevents spoofing of Layer 3 information by hosts.
    802.1x - Authenticates users before allowing their data frames into the network.
    DHCP snooping - Prevents rogue DHCP servers from impacting the network.
    Storm control - Limits the amount of broadcast or multicast traffic flowing through the switch.
    Access control list - Traffic control to enforce policy.

  CAM table overflow attack - malicious applications that sending thousands of frames into the network, with a different bogus MAC address for each frame, as the user tries to exhaust the limits of the dynamic MAC address table on the switch, which might cause the switch to forward all frames to all ports within a VLAN so that the attacker can begin to sniff all packets

IPV6
  Length: IPv6 addresses are 128 bits long.
  Groupings: IPv6 addresses are segmented into eight groups of four hex characters.
  Separation of groups: Each group is separated by a colon (:).
  Length of mask: Usually 50 percent (64 bits long) for network ID, which leaves 50 percent (also 64 bits) for interface ID (using a 64-bit mask).
  Number of networks: The network part is allocated by Internet registries 2^64 (1.8 x 1019)

  TYPES:
    Link local address: These always begin with the characters FE80. The last 64 bits are the host ID (also referred to as the interface ID), and the device uses the modified EUI-64 format (by default) to create that. The modified EUI-64 uses the MAC address (if on Ethernet; and if not on Ethernet, it borrows the MAC address of another interface), and realizes it is only 48 bits. To get to 64 bits for the host ID, it inserts four hexadecimal characters of FFFE, (which is the 16 more bits we need) and injects those into the middle of the existing MAC address to use as the 64-bit host ID. It also looks at the seventh bit from the left (of the original MAC address) and inverts it. If it is a 0 in the MAC address, it is a 1 in the host ID and vice versa. 

    Loopback address: The address is ::1 (which is 127 0s followed by a 1).

    All-nodes multicast address: In IPv6, multicasts begin with FFxx: (where the x = some other hex number). 02 happens to designate a multicast address that is link local in scope. There are other preset scopes, but you do not have to worry about them here. The IPv6 multicast group that all IPv6 devices join is FF02::1. If any device needs to send a packet/frame to all other local IPv6 devices, it can send the packet to the multicast address of FF02::1, which translates to a specific multicast Layer 2 address, and then all the devices that receive those frames continue to de-encapsulate those frames. If a device receives a frame, and the receiving device determines that the Layer 2 destination in the frame is not destined for itself and not destined for any multicast groups that the local device has joined, it discards the frame, instead of continuing to de-encapsulate it to find out what is inside (in the upper layers).

    All-routers multicast address: In addition to the group address of FF02::1 that is joined by all devices configured for IPv6, routers that have had routing enabled for IPv6 also join the group FF02::2. By doing so, any client looking for a router can send a request to this group address and get a response if there is a router on the local network. You might have noticed a pattern here: FF02 is just like 224.0.0.x in IPv4 multicast. 224.0.0.1 = all devices. 224.0.0.2 = all routers.

    Unicast and anycast addresses (configured automatically or manually): A global IPv6 address, unlike a link local address, is routable and can be reached through one or more routers that are running IP routing and that have a correct routing table. Global IPv6 unicast addresses have the first four characters in the range of 2000 to 3FFF, and may be manually configured, automatically discovered by issuing a router solicitation request to a local router, or be learned via IPv6 Dynamic Host Configuration Protocol (DHCP). An anycast address can be a route or an IP address that appears more than one time in a network, and then it is up to the network to decide the best way to reach that IP. Usually, two DNS servers, if they both use the same anycast address, are functional to the users, so that regardless of which DNS server that packets are forwarded to, the client gets the DNS response it needs.

    Solicited-node multicast address for each of its unicast and anycast addresses: When a device has global and link local addresses, it joins a multicast group of FF02::1:FFxx:xxxx The x characters represent the last 24 bits of the host ID being used for the addresses. If a device needs to learn the Layer 2 address of a peer on the same network, it can send out a neighbor solicitation (request) to the multicast group that the device that has that address should have joined. This is the way IPv6 avoids using broadcasts.

    Multicast addresses of all other groups to which the host belongs: If a router has enabled IPv6 routing, it joins the FF02::2 group (all routers), as mentioned earlier. If a router is running RIPng (the IPv6 flavor), it joins the multicast group for RIPng, which is FF02::9, so that it will process updates sent to that group from other RIP routers. Notice again some similarities. RIPv2 in IPv4 uses 224.0.0.9 as the multicast address!

  Enabling IPv6 Routing and Routing Protocols(conf)
    R1(config)# ipv6 unicast-routing
    R1(config)# int fa 0/1
    R1(config-if)# ipv6 rip MYRIP enable (RIPng)
    R1(config-if)# ipv6 ospf 1 area 0 (OSPFv3)
    R1(config-if)# ipv6 eigrp 1(EIGRP) 
    R1(config-if)# exit

    EIGRP only:
    R1(config)# ipv6 router eigrp 1
    R1(config-rtr)# no shutdown (Bringing the EIGRP routing process out of its default shutdown state)

    Verification:
    R1# show ipv6 protocol
    R1# show ipv6 route (outputs the IPv6 routes the router knows how to reach)

  Best Practices Common to Both IPv4 and IPv6:
    Physical security: Keep the room where the router is housed free (safe) from electrostatic and magnetic interference. 

    Device hardening: Disable services that are not in use and features and interfaces that are not in use.

    Control access between zones: Enforce a security policy that clearly identifies which packets are allowed between networks.

    Routing protocol security: Use authentication with routing protocols to help stop rogue devices from abusing the information being used in routing updates by your routers.

    Authentication, authorization, and accounting (AAA): Require AAA so that you know exactly who is accessing your systems, when they are accessing your systems, and what they are doing. 

    Mitigating DoS attacks: Denial of service refers to willful attempts to disrupt legitimate users from getting access to the resources they intend to. Although no complete solution exists, administrators can do specific things to protect the network from a DoS attack and to lessen its effects and prevent a would-be attacker from using a system as a source of an attack directed at other systems. These mitigation techniques include filtering based on bogus source IP addresses trying to come into the networks and vice versa. Unicast reverse path verification is one way to assist with this, as are access lists. Unicast reverse path verification looks at the source IP address as it comes into an interface, and then looks at the routing table. If the source address seen would not be reachable out of the same interface it is coming in on, the packet is considered bad and is dropped. Another technique to mitigate wellknown DoS attacks is some type of TCP Intercept, which can mitigate SYN-flood attacks.

    Have and update a security policy: A security policy should be referenced and possibly updated whenever major changes occur to the administrative practices, procedures, or staff. If new technologies are implemented, such as a new VPN or a new application that is using unique protocols or different protocols than your current security policy allows, this is another reason to revisit the security policy. Another time a security policy might need to be updated is after a significant attack or compromise to the network has been discovered.

  Threats Common to Both IPv4 and IPv6:
    Application layer attacks: An attacker is using a network service in an unexpected or malicious way. 

    Unauthorized access: Individuals not authorized for access are gaining access to network resources.

    Man-in-the-middle attacks: Someone or something is between the two devices who believe they are communicating directly with each other. 

    Sniffing or eavesdropping: An attacker is listening in on the network traffic of others.

    Denial-of-service (DoS) attacks: Making services that should be available unavailable to the users who should normally have the access/service.

    Spoofed packets: Forged addressing or packet content. 

    Attacks against routers and other network devices: Turning off unneeded services and hardening the routers, similar to what the CCP security audit can do, will help the router be less susceptible to attacks against the router itself.

  New Potential Risks with IPv6:
    Network Discovery Protocol: Clients discover routers using NDP, and if a rogue router is present, it could pretend to be a legitimate router and send incorrect information to the clients about the network, the default gateway, and other parameters.

    DHCPv6: A rogue router that has fooled a client about being a router could also manipulate the client into using incorrect DHCP-learned information.

    Hop-by-hop extension headers: With IPv4, there were IP options that could be included in IP headers. Malicious use of these headers could cause excessive CPU utilization on the routers that receive or forward these packets, in addition to dictating the path the packet should take through the network.

    Packet amplification attacks: Using multicast addresses rather than IPv4 broadcast addresses could allow an attacker to trick an entire network into responding to a request. 

    ICMPv6: This protocol is used extensively by IPv6 as its NDP. Much potential harm may result from manipulation of this protocol by an attacker.

    Tunneling options: Tunneling IPv6 through IPv4 parts of a network may mean that the details inside the IPv6 packet might not be inspected or filtered by the IPv4 network. 

    Autoconfiguration: Because an IPv6 host can automatically configure an IP address for itself, any trickery by a rogue router could also cause the host’s autoconfigura- tion to be done incorrectly, which could cause a failure on the network or a man-in- the-middle attack as the client tries to route all traffic through the rogue router.

    Dual stacks: If a device is running both IPv4 and IPv6 at the same time, but is aware of only one (or is primarily only using one), the other protocol stack if not secured is a potential way that an attacker could remotely access the device. 

    Bugs in code: Any newer software has the potential to have bugs, including the software that is supporting the IPv6 features in the network or end-station devices.

  IPv6 Best Practices
    Filter bogus addresses: Drop, at the end of your network, any addresses that should never be valid source or destination addresses(bogon address).

    Filter non-local multicast addresses: If you are not running multicast applica- tions, you should never need multicast to be forwarded beyond a specific VLAN.

    Filter ICMPv6 traffic that is not needed on your specific networks: Normal NDP uses ICMPv6 as its core protocol. A path’s maximum transmission unit (MTU) is also determined by using ICMP. Outside of its normal functionality, you want to filter the unused parts of ICMP so that an attacker cannot use it against your network.

    Drop routing header type 0 packets: Routing header 0, also known as RH0, may contain many intermediate next hops, and if followed an attacker could control the path of a packet through a network. 

    Use manual tunnels rather than automatic tunnels: If tunneling, do not use automatic tunnel mechanisms such as automatic 6to4, because you cannot control all of them. (They are dynamic.) With the manual tunnels, avoid allowing the tunnels to go through the perimeter of your network, as you will not have tight controls on the contents of the tunneled packets.

    Protect against rogue IPv6 devices: Secure Neighbor Discovery (SEND) and router advertisement guard (RA guard) can help in mitigating rogue routers.

  NA IPv6 neighbor advertisement. Used to communicate information from an IPv6 host to another on the same locally connected network.
  NS IPv6 neighbor solicitation. Used by an IPv6 speaker to make a request of one or more local IPv6 devices on the same network.
  RS IPv6 router solicitation request. Used by an IPv6 device to obtain information from an IPv6 router on the local network.

Threat Control and Mitigation Strategy Components
  Formal process for policy creation, implementation, and review - Senior management, ultimately, is responsible for policy. The job of the network administrator is to implement and enforce through technical and logical controls the policy that has been mandated. When there are changes to be made, a formal procedure, including change control and a written signoff by the person authorized for that change, should be in place. The documented history of change control should be kept. Auditing records detailing which administrators have accessed which systems, along with any changes that were made, should be kept and stored. This can be automated through services such as authentication, authorization, and accounting (AAA).

  Mitigation policies and techniques - A policy should be in place specifying the course of action in response to an attack or threat. Ideally, an automated system could retaliate against the attacker’s packets or activities to stop the attack and quarantine the area if possible. Reporting features should be such that the highest-ranking threats can be easily seen and addressed by both systems and administrators. An example of an automated response to an attacker may be a system that dynamically sends out blocking requests to perimeter routers that deny future packets from the attacker, or perhaps sending a TCP reset to the attacker and the proposed victim. A feature such as this could be implemented on an intrusion prevention system (IPS).

  End-user education and awareness - Because of smart phones, virtual private networks (VPN), and almost instant access everywhere, data is available at lots of different places. Having an end-user policy, educating the end users, and periodically reviewing and verifying that the end users are aware of their role in protecting the data is a critical piece in mitigating threats. An ounce of prevention here is worth a pound of forensics later if a compromise has occurred.

  Defense in depth - Defense in depth refers to a layered security approach, where multiple devices may have overlapping security responsibilities. This is desired so that a single failure of a given system does not represent a significant vulnerability of the entire network.

  Centralized monitoring and analysis - Ideally, with multiple devices providing security, you would have centralized monitoring where all the information can be easily sorted and viewed. This information coming in from all these devices should be correlated (which should be an automated process), for an enterprise-wide view of what is really happening. After seeing that an attack is taking place, a centralized tool may have the ability to recommend or even implement an appropriate countermeasure against the attack. (An example is to re-write an access control list [ACL] and apply it on a router that is in the path of the attacker.) External information from global correlation systems could also be used to harden the network against a global threat that may be headed in the direction of the current network.

  Application layer visibility - Well-known protocols, in the hands of an attacker, could be manipulated to cause harm to your network in the form of an attack. Application layer visibility is critical to verify whether protocol abuse is occurring (such as malformed requests, tunneling, and so on) so that the network can respond if needed and prevent the malicious traffic or application from proceeding further.

  Incident response - The policy should state what will happen and how it will happen as incidents occur on a network. Having a formal policy for this removes the ambiguity of how incidents are reported and the follow-up process documented after the event. The response may be administrative (manual) and automated.

NAT
  Inside local - The real IP configured on an inside host, such as PC1.

  Inside global - The mapped/global address that the router is swapping out for the inside host during NAT. The outside world sees PC1 coming from this mapped/global address

  Outside local - If performing NAT on outside devices (outside NAT), this is the mapped address of the outside device (such as Server A) as it would appear to inside hosts. If not doing outside NAT on the router, this appears as the normal outside device’s IP address to the inside devices.

  Outside global - The real IP configured on an outside host, such as the IP on Server A.

NAT options
  Static NAT - This is a one-to-one permanent mapping.

  Dynamic NAT - Dynamic NAT involves having a pool of global addresses, and only mapping those global addresses to inside devices when those inside devices have and need to go out to the Internet.

  Dynamic PAT (NAT with overload) - It combines the benefits of dynamically assigning global addresses only when needed, and it uses overload so that literally thousands of inside devices can be translated to the same global IP address.

  Policy NAT/PAT - Policy-based NAT is based on a set of rules, such as what is the source IP address, what is the destination IP address, and which ports are used that would qualify that packet to have NAT/PAT applied to it.

Firewall Design Considerations:
  Firewalls should be placed at security boundaries, such as between two networks that have different levels of trust (from the perspective of your organization). An Key￼example is your internal network compared to the Internet.

  Firewalls should be a primary security device, but not the only security device or security measure on the network.

  A policy that starts with a “deny all” attitude and then specifically only permits traf- fic that is required is a better security posture than a default “permit all” attitude first and then denying traffic specifically not wanted.

  Leverage the firewall feature that best suits the need.

  Make sure that physical security controls and management access to the firewall devices, and the infrastructure that supports them such as cables and switches, are secure.

  Have a regularly structured review process looking at the firewall logs.

  Practice change management for any configuration modification on the firewalls.

Firewall access rules:
  Rules based on service control - These rules are based on the types of services that may be accessed through the firewall, inbound or outbound.

  Rules based on address control - These rules are based on the source/destination addresses involved, usually with a permit or deny based on specific entries in an access control list.

  Rules based on direction control - These rules specify where the initial traffic can flow. 

  Rules based on user control - These rules control access based on knowing who the user is and what that user is authorized to do. This can be implemented via AAA services.

  Rules based on behavior control - These rules control how a particular service is used. For example, a firewall may implement an email filter to protect against spam.

Rule Implementation Consistency:
  - Rules that are too promiscuous: These types of rules allow more access than is necessary for the business requirement.
  - Redundant rules
  - Shadowed rules: A shadowed rule is basically incorrect order placement in the access list.
  - Orphaned rules: This most likely results from a configuration error that is referencing incorrect IPs that would never be seen by the firewall. 
  - Incorrectly planned rules: This may result from an error that is made as the business requirements are being translated to the technical and logical controls that the firewall will implement.
  - Incorrectly implemented rules: This results from an administrator implementing the incorrect port, protocol, or IP information on the firewall.

ZBF features:
  Stateful inspection
  - Application inspection
  - Packet filtering
  - URL filtering
  - Transparent firewall (implementation method)
  - Support for virtual routing and forwarding (VRF)
  - Access control lists (ACL) are not required as a filtering method to implement the policy

  Cisco Common Classification Policy Language (C3PL):
    - Class maps: These are used to identify traffic, such as traffic that should be inspected. 

    - Policy maps: These are the actions that should be taken on the traffic.
      Inspect = Permit and statefully inspect the traffic
      Pass = Permits/allows the traffic but does not create an entry in the stateful database
      Drop = Deny the packet
      Log = Log the packets

    - Service policies: This is where you apply the policies, identified from a policy map, to a zone pair. This step actually implements the policy.

ZBF(config)
  R3(config)# class-map type inspect match-any MY-CLASS-MAP (The class map "classifies" or "identifies" the traffic) 
  R3(config-cmap)# match protocol telnet
  R3(config-cmap)# match protocol icmp
  R3(config-cmap)# exit
  R3(config)# policy-map type inspect MY-POLICY-MAP (The policy map calls on a specific class map that it wants to use)
  R3(config-pmap)# class type inspect MY-CLASS-MAP
  R3(config-pmap-c)# inspect
  R3(config-pmap-c)# exit
  R3(config-pmap)# exit
  R3(config)# zone security inside (create the security zones)
  R3(config-sec-zone)# exit
  R3(config)# zone security outside 
  R3(config-sec-zone)# exit
  R3(config-sec-zone)# zone-pair security in-to-out source inside destination outside (Create the zone-pair, specifying the zones and the direction (from where to where))
  R3(config-sec-zone-pair)# service-policy type inspect MY-POLICY-MAP (Use the service-policy command in zone-pair configuration mode to apply the policy map)
  R3(config-sec-zone-pair)# exit
  R3(config)# interface GigabitEthernet3/0 (Configure the interfaces, so they become members of the respective zones)
  R3(config-if)# description Belongs to outside zone
  R3(config-if)# zone-member security outside
  R3(config-if)# exit
  R3(config)# interface GigabitEthernet1/0 
  R3(config-if)# description Belongs to inside zone 
  R3(config-if)# zone-member security inside 
  R3(config-if)# exit

  Verifying
  R3# show class-map type inspect
  R3# show policy-map type inspect zone-pair ccp-zp-in-out sessions

  NAT(config)
  R3(config)# access-list 2 permit 10.0.0.0 0.0.0.255 (identify the packets)
  R3(config)# interface GigabitEthernet3/0
  R3(config-if)# ip nat outside
  R3(config-if)# exit
  R3(config)# interface GigabitEthernet1/0
  R3(config-if)# ip nat inside
  R3(config-if)# exit
  R3(config)# ip nat inside source list 2 interface GigabitEthernet3/0 overload (overload keyword indicates PAT)
  R3# show ip nat translations
  R3# show ip nat translations * (Show current active address translations occurring on the router)

ASA Features and Services
  Packet filtering: Simple packet filtering normally represents an access list.

  Stateful filtering: By default, the ASA enters stateful tracking information about packets that have been initially allowed through the firewall.

  Application inspection/awareness: The ASA can listen in on conversations between devices on one side and devices on the other side of the firewall. 

  Network Address Translation (NAT): It supports inside and outside NAT, and both static and dynamic NAT and PAT, including Policy NAT, which is only triggered based on specific matches of IP addresses or ports. 

  DHCP: The ASA can act as a Dynamic Host Configuration Protocol (DHCP) server or client or both. 

  Routing: The ASA supports most of the interior gateway routing protocols, includ- ing RIP, EIGRP, and OSPF.

  Layer 3 or Layer 2 implementation: The ASA can be implemented as a tradi- tional Layer 3 firewall, which has IP addresses assigned to each of its routable interfaces.

  VPN support: The ASA can operate as either the head-end or remote-end device for VPN tunnels. When using IPsec, the ASA can support remote-access VPN users and site-to-site VPN tunnels.

  Object groups: An object group is a configuration item on the ASA that refers to one or more items.

  Botnet traffic filtering: The ASA works with an external system at Cisco that provides information about the Botnet Traffic Filter Database and so can protect against this.

  High availability: By using two firewalls in a high-availability failover combination, you can implement protection against a single system failure.

  AAA support

  ASA(Config)
    (config)# configure terminal
    (config)# interface Vlan1
    (config-if)# no shutdown
    (config-if)# description Connect to the dmz
    (config-if)# nameif dmz
    (config-if)# security-level 50
    (config-if)# ip address 192.168.1.254 255.255.255.0 
    (config-if)# exit
    (config)# interface Vlan2
    (config-if)# no shutdown
    (config-if)# description Connects to my private network 
    (config-if)# nameif inside
    (config-if)# security-level 100 
    (config-if)# ip address 10.0.0.1 255.255.255.0 
    (config-if)# exit
    (config)# interface Vlan4 
    (config-if)# no shutdown 
    (config-if)# description Connects to the Internet 
    (config-if)# no forward interface Vlan2 
    (config-if)# nameif outside 
    (config-if)# security-level 0 
    (config-if)# ip address 23.1.2.3 255.255.255.240 
    (config-if)# exit
    (config)# interface Ethernet0/1
    (config-if)# switchport access vlan 4 
    (config-if)# exit
    (config)#
    (config)# interface Ethernet0/2
    (config-if)# switchport access vlan 2 
    (config-if)# exit
    (config)#
    (config)# interface Ethernet0/3
    (config-if)# switchport access vlan 2 
    (config-if)# exit
    (config)#
    (config)# interface Ethernet0/4
    (config-if)# switchport access vlan 2
    (config-if)# exit 
    (config)#
    (config)# interface Ethernet0/5 
    (config-if)# switchport access vlan 2 
    (config-if)# exit 
    (config)#
    (config)# interface Ethernet0/6 
    (config-if)# switchport access vlan 2 
    (config-if)# exit 
    (config)#
    (config)# interface Ethernet0/7 
    (config-if)# switchport access vlan 2 
    (config-if)# exit

    DCHP configuration in ASA
    (config)# dhcpd address 10.0.0.101-10.0.0.132 inside 
    (config)# dhcpd enable inside
    (config)# dhcpd dns 8.8.8.8 interface inside 
    (config)# dhcpd domain iins.com interface inside

    Static route in ASA
    (config)# route outside 0.0.0.0 0.0.0.0 23.1.2.7

    PAT with ASA
    (config)# object network Inside_Hosts 
    (config-network-object)# subnet 10.0.0.0 255.255.255.0 
    (config-network-object)# description Inside_Hosts 
    (config-network-object)# exit
    (config)# nat (inside,outside) 1 source dynamic Inside_Hosts interface

    ACL with ASA
    (config)# access-list inside_access_in deny tcp any any eq telnet 
    (config)# access-list inside_access_in permit ip any any 
    (config)# access-group inside_access_in in interface inside

IPS/IDS
  Positive/Negative
    False positive: is when the sensor generates an alert about traffic and that traffic is not malicious or important as related to the safety of the network.

    False negative: is when there is malicious traffic on the network, and for whatever reason the IPS/IDS did not trigger an alert

    True positive: means that there was malicious traffic and that the sensor saw it and reported on it.

    True negative: is also a wonderful thing in that there was normal non-malicious traffic, and the sensor did not generate any type of alert, which is normal sensor behavior regad- ing non-malicious traffic.

  Identifying Malicious Traffic:
    Signature-Based IPS/ID: is just a set of rules looking for some specific pattern or characteristic in either a single packet or a stream of packets.
      atomic - Signatures that can match on a single packet, as compared to a string of packets
      Service - Signatures that examine application layer services, regardless of the operating system
      String or Multistring - Supports flexible pattern matching, and can be identified in a single packet or group of packets, such as a session
      Other - Miscellaneous signatures that may not specifically fit into other categories
      
    Policy-Based IPS/IDS: implemented based on the policy for your network.

    Anomaly-Based IPS/IDS: is used to identify worms that may be propagating through the network.

    Reputation-Based IPS/IDS: collects input from systems all over the planet that are participating in global correlation; so what other sensors have learned collectively, your local sensor can use locally.

  Risk Rating (RR) Calculation Factors:
    Target value rating (TVR): The value that you as an administrator have assigned to specific destination IP addresses or subnets where the critical servers/ devices live.

    Signature fidelity rating (SFR): The accuracy of the signature as determined by the person who created that signature.

    Attack severity rating (ASR): How critical the attack is as determined by the person who created that signature.

    Attack relevancy (AR): This is a minor contributor to the risk rating. A signature match that is destined to a host where the attack is relevant, such as a Windows server-based attack, which is going to the destination address of a known Windows server, is considered a relevant attack, and the risk rating increases slightly as a result.

    Global correlation: If the sensor is participating in global correlation and receives information about specific source addresses that are being used to implement large-scale attacks, attacks coming from the source IP addresses are also given a slightly increased risk rating value.

IPS
    - profile based
    - signature based
    - protocol analysis based

  Actions That May Be Taken:
    - Deny attacker inline
    - Deny connection inline
    - Deny packet inline
    - Produce alert (the default action for most signatures)
    - Reset TCP connection (effective only against TCP-based attacks)

VPNs Tecnologies:
  IPsec: Implements security of IP packets at Layer 3 of the OSI model, and can be used for site-to-site VPNs and remote-access VPNs.
  SSL: Secure Sockets Layer implements security of TCP sessions at Layer 4 of the OSI model, and can be used for remote-access VPNs (as well as being used to securely visit a web server that supports it via HTTPS).
Key Topic
  MPLS: Multiprotocol Label Switching and MPLS Layer 3 VPNs are provided by a service provider to allow a company with two or more sites to have logical connec- tivity between the sites using the service provider network for transport.

Types of VPNs:
  - Remote-access VPNs: Some users might need to build a VPN connection from their individual computer to the corporate headquarters (or to the destination they want to connect to).

  - Site-to-site VPNs: The other main VPN implementation is by companies that may have two or more sites that they want to connect securely together (likely using the Internet) so that each site can communicate with the other site or sites.

Benefits of VPNs
  - Confidentiality
  - Data integrity
  - Authentication
  - Antireplay

Certificate relevant parts:
  - Serial number: Issued and tracked by the CA that issued the certificate.
  - Issuer: The CA that issued this certificate (Even root certificates need to have their certificates issued from someone (perhaps even themselves).
  - Validity dates: The time window during which the certificate may be considered valid. If a local computer believes the date to be off by a few years, that same PC may consider the certificate invalid due to his own error about the time. Using Network Time Protocol (NTP) is a good idea to avoid this problem.
  - Subject of the certificate: This includes the Organizational Unit (OU), Organization (O), Country (C), and other details commonly found in an X.500 structured directory (more on that later in the chapter). The subject of the root certificate is the CA itself. The subject for a client’s identity certificate is the client.
  - Public key: The contents of the public key and the length of the key are often both shown. After all, the public key is public.
  - Thumbprint algorithm and thumbprint: This is the hash for the certificate. On a new root certificate, you could use a phone to call and ask for the hash value and compare it to the hash value you see on the certificate. If it matches, you have just performed out-of-band (using the telephone) verification of the digital certificate.

  Contents of a Digital Certificate:
    - Serial number: Assigned by the CA and used to uniquely identify the certificate
    - Subject: The person or entity that is being identified
    - Signature algorithm: The specific algorithm that was used for signing the digital certificate
    - Signature: The digital signature from the certificate authority, which is used by devices that want to verify the authenticity of the certificate issued by that CA
    - Issuer: The entity or CA that created and issued the digital certificate
    - Valid from: The date the certificate became valid
    - Valid to: The expiration date of the certificate
    - Key usage: The functions for which the public key in the certificate may be used
    - Public key: The public portion of the public and private key pair generated by the host whose certificate is being looked at
    - Thumbprint algorithm: The hash algorithm used for data integrity
    - Thumbprint: The actual hash
    - Certificate revocation list location: The URL that can be checked to see whether the serial number of any certificates issued by the CA have been revoked

  Public Key Cryptography Standards:
    - PKCS #10: This is a format of a certificate request sent to a CA who wants to receive their identity certificate. This type of request would include the public key for the entity desiring a certificate.
    - PKCS #7: This is a format that can be used by a CA as a response to a PKCS#10 request. The response itself will very likely be the identity certificate (or certificates) that had been previously requested.
    - PKCS#1: RSA Cryptography Standard.
    - PKCS#12: A format for storing both public and private keys using a symmetric password-based key to “unlock” the data whenever the key needs to be used or accessed.
    - PKCS#3: Diffie-Hellman key exchange.

  Revoked Certificates
    - Certificate Revocation List (CRL): This is a list of certificates, based on their serial numbers, that had initially been issued by a CA but have since been revoked and as a result should not be trusted. A CRL could be very large, and the client would have to process the entire list to verify the certificate is not on the list. A CRL can be thought of as the naughty list. This is the primary protocol used for this purpose, compared to OSCP and AAA. A CRL could be accessed by several protocols, including LDAP and HTTP. A CRL could also be obtained via SCEP.
    - Online Certificate Status Protocol (OSCP): This is an alternative to CRLs. Using this method, a client simply sends a request to find the status of a certificate and gets a response without having to know the complete list of revoked certificates.
    - Authentication, authorization, and accounting (AAA): Cisco AAA services also provide support for validating digital certificates, including a check to see whether a certificate has been revoked. Because this is a proprietary solution, this is not often used in PKI.

  PKI Components:
    RSA digital signatures - Using its private key to encrypt a generated hash, a digital signature is created. The receiver uses the public key of the sender to validate the digital signature and verify the identity of the peer.

    Digital certificate - File that contains the public key of the entity, a serial number, and the signature of the CA that issued the certificate

    Public and private keys - Used as a pair to encrypt and decrypt data in an asymmetrical fashion.

    Certificate authority - The CA’s job is to fulfill certificate requests and generate the digital certificates for its clients to use. It also maintains a list of valid certificates that have been issued, and maintains a CRL listing any revoked certificates.

    X.509v3 - A common certificate format used today.

    Subordinate CA/ RA - Assistant to the CA, which can issue certificates to clients. Clients need both the certificates from the root and the subordinate to verify signatures all the way to the root. Used in a hierarchal PKI topology.

    PKCS - Public Key Cryptography Standards, agreed to and implemented by vendors who want the ability to have compatibility with other devices in the PKI.

  IKE Phase 1
    H: Hash
    A: Authentication method
    G: DH group (a stretch, but it works)
    L: Lifetime of the IKE Phase 1 tunnel
    E: Encryption algorithm to use for the IKE Phase 1 tunnel



































